import{u as T,a as E,s as c,j as e,L as z}from"./index-NMPGEa1P.js";import{r as a,P as j,i as N,G as _,d as D,U as L,m as M,n as F}from"./ui-FliD9Jbj.js";import{C as O}from"./ConfirmModal-CsTdeKkB.js";import"./vendor-CH429gIm.js";import"./supabase-CWr6oBKi.js";import"./utils-CSQe5d3I.js";const Z=()=>{const{user:m}=T(),{showSuccess:u,showError:x}=E(),[f,w]=a.useState([]),[v,p]=a.useState(!0),[P,i]=a.useState(!1),[d,b]=a.useState(null),[l,n]=a.useState({isOpen:!1,port:null,loading:!1}),[r,o]=a.useState({name:"",code:"",location:"",timezone:"UTC"});a.useEffect(()=>{m?.role==="terminal"&&h()},[m]);const h=async()=>{try{p(!0);const{data:t,error:s}=await c.from("ports").select(`
          *,
          terminal_manager:users!ports_terminal_manager_id_fkey(name, email)
        `).order("name");if(s)throw s;w(t||[])}catch{x("Failed to load ports","Please refresh the page and try again")}finally{p(!1)}},C=async t=>{t.preventDefault();try{if(d){const{error:s}=await c.from("ports").update(r).eq("id",d.id);if(s)throw s;u("Port updated successfully!","The port information has been updated.")}else{const{error:s}=await c.from("ports").insert([r]);if(s)throw s;u("Port created successfully!","The new port has been added.")}y(),h()}catch(s){const g=s instanceof Error?s.message:"An unexpected error occurred";x("Failed to save port",g)}},S=t=>{b(t),o({name:t.name,code:t.code,location:t.location,timezone:t.timezone}),i(!0)},k=async t=>{n(s=>({...s,loading:!0}));try{const{error:s}=await c.from("ports").delete().eq("id",t);if(s)throw s;u("Port deleted successfully!","The port and all associated data have been removed."),h(),n({isOpen:!1,port:null,loading:!1})}catch(s){const g=s instanceof Error?s.message:"An unexpected error occurred";x("Failed to delete port",g)}finally{n(s=>({...s,loading:!1}))}},y=()=>{o({name:"",code:"",location:"",timezone:"UTC"}),b(null),i(!1)},A=["UTC","America/New_York","America/Los_Angeles","America/Sao_Paulo","Europe/London","Europe/Amsterdam","Asia/Singapore","Asia/Tokyo","Australia/Sydney"];return m?.role!=="terminal"?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"This section is only available for terminal operators."})}):v?e.jsx("div",{className:"h-64",children:e.jsx(z,{size:"lg",text:"Loading ports..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Port Management"}),e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Add Port"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-8 w-8 text-blue-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500 font-mono",children:t.code})]})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),t.location]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),t.timezone]}),t.terminal_manager&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Terminal Manager: ",t.terminal_manager.name]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>S(t),className:"p-2 text-gray-400 hover:text-blue-600",title:"Edit port",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>n({isOpen:!0,port:t,loading:!1}),className:"p-2 text-gray-400 hover:text-red-600",title:"Delete port",children:e.jsx(F,{className:"h-4 w-4"})})]})]},t.id))}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No ports configured"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start by adding your first port."}),e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Add Your First Port"]})]}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:d?"Edit Port":"Add New Port"})}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Port Name *"}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:t=>o({...r,name:t.target.value}),placeholder:"e.g., Port of Santos",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Port Code *"}),e.jsx("input",{type:"text",required:!0,value:r.code,onChange:t=>o({...r,code:t.target.value.toUpperCase()}),placeholder:"e.g., BRSSZ",maxLength:5,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"5-letter UN/LOCODE"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Location *"}),e.jsx("input",{type:"text",required:!0,value:r.location,onChange:t=>o({...r,location:t.target.value}),placeholder:"e.g., Santos, Brazil",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Timezone *"}),e.jsx("select",{required:!0,value:r.timezone,onChange:t=>o({...r,timezone:t.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:A.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:[d?"Update":"Create"," Port"]})]})]})]})}),e.jsx(O,{isOpen:l.isOpen,onClose:()=>n({isOpen:!1,port:null,loading:!1}),onConfirm:()=>l.port&&k(l.port.id),title:"Delete Port",message:`Are you sure you want to delete "${l.port?.name}"? This will also delete all associated services and reservations. This action cannot be undone.`,type:"danger",confirmText:"Delete",loading:l.loading})]})};export{Z as default};
