import{u as z,a as B,s as o,j as e}from"./index-CufYMjLy.js";import{r as l,P as S,e as I,X as L,k as U,l as Y,i as H,D as Q,m as V,n as W}from"./ui-FliD9Jbj.js";import{S as X}from"./SmartStatusBadge-BftyY1xO.js";import{C as G}from"./ConfirmModal-NTQzFaZh.js";import"./vendor-CH429gIm.js";import"./supabase-CWr6oBKi.js";import"./utils-CSQe5d3I.js";const ae=()=>{const{user:t}=z(),{showSuccess:d,showError:x}=B(),[v,k]=l.useState([]),[h,C]=l.useState([]),[f,D]=l.useState([]),[A,y]=l.useState(!0),[q,g]=l.useState(!1),[b,j]=l.useState(null),[u,m]=l.useState({isOpen:!1,service:null,loading:!1}),[i,n]=l.useState({name:"",type:"tugboat",description:"",port_id:"",price_per_hour:"",availability:!0}),c=l.useCallback(async()=>{try{y(!0);let r=o.from("services").select(`
          *,
          ports (*)
        `).order("created_at",{ascending:!1});t.role==="provider"?r=r.eq("provider_id",t.id):t.role==="terminal"&&t.port_id?r=r.eq("port_id",t.port_id):t.role==="captain"&&(r=r.eq("availability",!0));const{data:s,error:a}=await r;if(a)throw a;k(s||[]);let p=o.from("ports").select("*").order("name");t.role==="terminal"&&t.port_id&&(p=p.eq("id",t.port_id));const{data:O,error:_}=await p;if(_)throw _;if(C(O||[]),t.role==="provider"){const{data:R,error:$}=await o.from("reservations").select(`
            *,
            services!inner (
              *,
              ports (*)
            )
          `).eq("services.provider_id",t.id).eq("provider_approval","pending").order("created_at",{ascending:!1});$||D(R||[])}}catch{}finally{y(!1)}},[t]);l.useEffect(()=>{t?.role==="provider"&&c()},[t,c]);const E=async r=>{if(r.preventDefault(),!!t)try{const s={name:i.name,type:i.type,description:i.description,port_id:i.port_id,provider_id:t.id,price_per_hour:i.price_per_hour?parseFloat(i.price_per_hour):null,availability:i.availability};if(b){const{error:a}=await o.from("services").update(s).eq("id",b.id);if(a)throw a;d("Service updated successfully!","Your service has been updated.")}else{const{error:a}=await o.from("services").insert([s]);if(a)throw a;d("Service created successfully!","Your new service is now available.")}w(),c()}catch(s){const a=s instanceof Error?s.message:"An unexpected error occurred";x("Failed to save service",a)}},P=r=>{j(r),n({name:r.name,type:["tugboat","bunkering","cleaning","maintenance","docking"].includes(r.type)?r.type:"tugboat",description:r.description||"",port_id:r.port_id,price_per_hour:r.price_per_hour?.toString()||"",availability:r.availability}),g(!0)},M=async r=>{m(s=>({...s,loading:!0}));try{const{error:s}=await o.from("services").delete().eq("id",r);if(s)throw s;d("Service deleted successfully!","The service has been removed."),c(),m({isOpen:!1,service:null,loading:!1})}catch(s){const a=s instanceof Error?s.message:"An unexpected error occurred";x("Failed to delete service",a)}finally{m(s=>({...s,loading:!1}))}},F=async r=>{try{const{error:s}=await o.from("services").update({availability:!r.availability}).eq("id",r.id);if(s)throw s;c(),d("Service availability updated",`Service is now ${r.availability?"unavailable":"available"}.`)}catch(s){const a=s instanceof Error?s.message:"An unexpected error occurred";x("Failed to update service availability",a)}},N=async(r,s)=>{try{const{error:a}=await o.from("reservations").update({provider_approval:s,provider_approved_at:new Date().toISOString(),provider_approved_by:t?.id,updated_at:new Date().toISOString()}).eq("id",r);if(a)throw a;d("Provider Approval Updated",`Reservation has been ${s==="approved"?"approved":"rejected"} by provider successfully.`),c()}catch(a){const p=a instanceof Error?a.message:"Failed to update reservation";x("Error",p)}},w=()=>{n({name:"",type:"tugboat",description:"",port_id:"",price_per_hour:"",availability:!0}),j(null),g(!1)},T=r=>{switch(r){case"tugboat":return"🚢";case"bunkering":return"⛽";case"cleaning":return"🧽";case"maintenance":return"🔧";case"cargo_handling":return"📦";case"vessel_berthing":return"🏗️";case"pilotage":return"🧭";case"customs_clearance":return"📋";case"waste_disposal":return"♻️";case"security":return"🛡️";default:return"⚓"}};return t?.role!=="provider"?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"This section is only available for service providers."})}):A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t?.role==="terminal"?"Port Services Management":"My Services"}),t?.role==="terminal"&&h.length>0&&e.jsxs("p",{className:"text-gray-600 mt-1",children:["Managing services for ",e.jsx("strong",{children:h[0]?.name})," (",h[0]?.code,")"]})]}),e.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Add Service"]})]}),t?.role==="provider"&&f.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Pending Provider Approvals"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Reservations waiting for your approval"})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:f.map(r=>e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-2xl",children:"🚢"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:r.ship_name}),e.jsx(X,{status:r.status,terminalApproval:r.terminal_approval||"pending",providerApproval:r.provider_approval||"pending",userRole:"provider",size:"sm"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.services?.name," • ",new Date(r.requested_date).toLocaleDateString()," at ",r.requested_time]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Duration: ",r.duration_hours,"h",r.captain_notes&&` • Notes: ${r.captain_notes}`]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>N(r.id,"approved"),className:"px-3 py-1 text-xs font-medium text-green-600 bg-green-50 rounded-full hover:bg-green-100 flex items-center space-x-1",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{children:"Approve"})]}),e.jsxs("button",{onClick:()=>N(r.id,"rejected"),className:"px-3 py-1 text-xs font-medium text-red-600 bg-red-50 rounded-full hover:bg-red-100 flex items-center space-x-1",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:"Reject"})]})]})]})},r.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(r=>e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:T(r.type)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:r.type})]})]}),e.jsx("button",{onClick:()=>F(r),className:"text-gray-400 hover:text-gray-600",children:r.availability?e.jsx(U,{className:"h-6 w-6 text-green-500"}):e.jsx(Y,{className:"h-6 w-6 text-gray-400"})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),r.ports?.name]}),r.price_per_hour&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"$",r.price_per_hour,"/hour"]})]}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:r.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${r.availability?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.availability?"Available":"Unavailable"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>P(r),className:"p-1 text-gray-400 hover:text-blue-600",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m({isOpen:!0,service:r,loading:!1}),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(W,{className:"h-4 w-4"})})]})]})]},r.id))}),v.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚓"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No services yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start by adding your first service offering."}),e.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Add Your First Service"]})]}),q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:b?"Edit Service":"Add New Service"})}),e.jsxs("form",{onSubmit:E,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Service Name *"}),e.jsx("input",{type:"text",required:!0,value:i.name,onChange:r=>n({...i,name:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Service Type *"}),e.jsxs("select",{required:!0,value:i.type,onChange:r=>n({...i,type:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"tugboat",children:"Tugboat"}),e.jsx("option",{value:"bunkering",children:"Bunkering"}),e.jsx("option",{value:"cleaning",children:"Cleaning"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"docking",children:"Docking/Pier Services"}),e.jsx("option",{value:"cargo_handling",children:"Cargo Handling"}),e.jsx("option",{value:"vessel_berthing",children:"Vessel Berthing"}),e.jsx("option",{value:"pilotage",children:"Pilotage"}),e.jsx("option",{value:"customs_clearance",children:"Customs Clearance"}),e.jsx("option",{value:"waste_disposal",children:"Waste Disposal"}),e.jsx("option",{value:"security",children:"Security"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Port *"}),e.jsxs("select",{required:!0,value:i.port_id,onChange:r=>n({...i,port_id:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select a port"}),h.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.code,")"]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Price per Hour"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:i.price_per_hour,onChange:r=>n({...i,price_per_hour:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{rows:3,value:i.description,onChange:r=>n({...i,description:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"availability",checked:i.availability,onChange:r=>n({...i,availability:r.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"availability",className:"ml-2 block text-sm text-gray-900",children:"Available for booking"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:w,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:[b?"Update":"Create"," Service"]})]})]})]})}),e.jsx(G,{isOpen:u.isOpen,onClose:()=>m({isOpen:!1,service:null,loading:!1}),onConfirm:()=>u.service&&M(u.service.id),title:"Delete Service",message:`Are you sure you want to delete "${u.service?.name}"? This action cannot be undone.`,type:"danger",confirmText:"Delete",loading:u.loading})]})};export{ae as default};
