import{u as F,a as A,s as j,j as e,B as $,L as T,b as I}from"./index-NMPGEa1P.js";import{r as i,S as D,i as L,j as R,D as z,d as E,T as O,F as B,P}from"./ui-FliD9Jbj.js";import{f as U}from"./utils-CSQe5d3I.js";import"./vendor-CH429gIm.js";import"./supabase-CWr6oBKi.js";const G=({onClose:m,onSuccess:t})=>{const{user:u}=F(),{showSuccess:n,showError:c}=A(),[h,p]=i.useState(!1),[y,N]=i.useState([]),[f,g]=i.useState([]),[d,C]=i.useState(""),[b,w]=i.useState(""),[a,x]=i.useState({ship_name:"",ship_imo:"",requested_date:"",requested_time:"",duration_hours:1,notes:""});i.useEffect(()=>{q()},[]),i.useEffect(()=>{d&&_(d)},[d]);const q=async()=>{try{const{data:r,error:o}=await j.from("ports").select("*").order("name");if(o)throw o;N(r||[])}catch{}},_=async r=>{try{const{data:o,error:l}=await j.from("services").select("*").eq("port_id",r).eq("availability",!0).order("name");if(l)throw l;g(o||[])}catch{}},s=async r=>{if(r.preventDefault(),!(!u||!b)){p(!0);try{const o={service_id:b,captain_id:u.id,ship_name:a.ship_name.trim(),ship_imo:a.ship_imo?.trim()||null,requested_date:a.requested_date,requested_time:a.requested_time,duration_hours:a.duration_hours,captain_notes:a.notes?.trim()||null,status:"pending"};console.log("Criando reserva com dados:",o);const{error:l}=await j.from("reservations").insert([o]).select();if(l)throw console.error("Erro detalhado:",l),l;n("Reservation created successfully!","Your reservation has been submitted and is pending approval."),t(),m()}catch(o){let l="An unexpected error occurred";o instanceof Error?l=o.message:typeof o=="object"&&o!==null&&"message"in o&&(l=String(o.message)),c("Failed to create reservation",l)}finally{p(!1)}}},S=f.find(r=>r.id===b),k=S?.price_per_hour?S.price_per_hour*a.duration_hours:null;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"New Service Reservation"})}),e.jsxs("form",{onSubmit:s,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Ship Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Ship Name *"}),e.jsx("input",{type:"text",required:!0,value:a.ship_name,onChange:r=>x({...a,ship_name:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"IMO Number (Optional)"}),e.jsx("input",{type:"text",value:a.ship_imo,onChange:r=>x({...a,ship_imo:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),"Service Selection"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Port *"}),e.jsxs("select",{required:!0,value:d,onChange:r=>C(r.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select a port"}),y.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.code,")"]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Service *"}),e.jsxs("select",{required:!0,value:b,onChange:r=>w(r.target.value),disabled:!d,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select a service"}),f.map(r=>e.jsxs("option",{value:r.id,children:[r.name," - ",r.type,r.price_per_hour&&` ($${r.price_per_hour}/hr)`]},r.id))]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Schedule"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date *"}),e.jsx("input",{type:"date",required:!0,value:a.requested_date,onChange:r=>x({...a,requested_date:r.target.value}),min:new Date().toISOString().split("T")[0],className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Time *"}),e.jsx("input",{type:"time",required:!0,value:a.requested_time,onChange:r=>x({...a,requested_time:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Duration (hours) *"}),e.jsx("input",{type:"number",required:!0,min:"1",max:"24",value:a.duration_hours,onChange:r=>x({...a,duration_hours:parseInt(r.target.value)}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]})]}),k&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:["Estimated Cost: $",k.toFixed(2)]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Additional Notes"}),e.jsx("textarea",{rows:3,value:a.notes,onChange:r=>x({...a,notes:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Any special requirements or notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50",children:h?"Creating...":"Create Reservation"})]})]})]})})},v=({children:m,className:t="",padding:u="md",shadow:n="soft",hover:c=!1,onClick:h})=>{const p="bg-white rounded-xl border border-secondary-200 transition-all duration-200",y={none:"",sm:"p-4",md:"p-6",lg:"p-8"},N={none:"",soft:"shadow-soft",medium:"shadow-medium",strong:"shadow-strong"},f=c?"hover:shadow-medium hover:-translate-y-1":"",g=`${p} ${y[u]} ${N[n]} ${f} ${t}`;return e.jsx("div",{className:g,onClick:h,children:m})},Q=({icon:m,title:t,description:u,action:n,className:c=""})=>e.jsxs("div",{className:`text-center py-12 px-6 ${c}`,children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-3 bg-secondary-100 rounded-full text-secondary-400",children:m})}),e.jsx("h3",{className:"text-lg font-medium text-secondary-900 mb-2",children:t}),e.jsx("p",{className:"text-secondary-600 mb-6 max-w-sm mx-auto",children:u}),n&&e.jsx($,{onClick:n.onClick,icon:n.icon,className:"animate-fade-in",children:n.label})]}),K=({setCurrentPage:m})=>{const{user:t}=F(),{showSuccess:u,showError:n}=A(),[c,h]=i.useState([]),[p,y]=i.useState([]),[,N]=i.useState([]),[f,g]=i.useState(!0),[d,C]=i.useState("all"),[b,w]=i.useState(!1),a=i.useCallback(async()=>{if(t)try{g(!0);let s=j.from("reservations").select(`
        *,
        services (
          *,
          ports (*)
        )
      `);t.role==="captain"?s=s.eq("captain_id",t.id):t.role==="provider"&&(s=s.eq("services.provider_id",t.id));const{data:S,error:k}=await s;if(k?n("Failed to load reservations","Please refresh the page and try again"):h(S||[]),t.role==="provider"){const{data:l,error:M}=await j.from("services").select("*, ports (*)").eq("provider_id",t.id);M?n("Failed to load services","Please refresh the page and try again"):y(l||[])}const{data:r,error:o}=await j.from("ports").select("*");o?n("Failed to load ports","Please refresh the page and try again"):N(r||[])}catch{n("Failed to load dashboard data","Please refresh the page and try again")}finally{g(!1)}},[t]);i.useEffect(()=>{a()},[a]);const x=s=>{switch(s){case"pending":return"warning";case"confirmed":return"success";case"rejected":return"error";case"completed":return"primary";case"cancelled":return"secondary";default:return"secondary"}},q=s=>{switch(s){case"tugboat":return"🚢";case"bunkering":return"⛽";case"cleaning":return"🧽";case"maintenance":return"🔧";case"docking":return"🏗️";default:return"⚓"}},_=c.filter(s=>d==="all"?!0:s.status===d);return f?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(T,{size:"lg",text:"Loading dashboard..."})}):e.jsxs("div",{className:"space-y-8",children:[e.jsx(v,{padding:"lg",className:"bg-gradient-to-r from-primary-50 to-secondary-50 border-primary-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-secondary-900 mb-2",children:["Welcome back, ",t?.name,"!"]}),e.jsxs("p",{className:"text-secondary-600 text-lg",children:[t?.role==="captain"&&"Manage your vessel service reservations",t?.role==="provider"&&"Track your service bookings and availability",t?.role==="terminal"&&"Monitor port operations and resource allocation"]})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"p-4 bg-primary-100 rounded-full",children:e.jsx(D,{className:"h-8 w-8 text-primary-600"})})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(v,{hover:!0,className:"group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-secondary-600 mb-1",children:"Total Reservations"}),e.jsx("p",{className:"text-3xl font-bold text-secondary-900",children:c.length}),e.jsx("p",{className:"text-xs text-secondary-500 mt-1",children:"All time"})]}),e.jsx("div",{className:"p-3 bg-primary-100 rounded-xl group-hover:bg-primary-200 transition-colors",children:e.jsx(R,{className:"h-6 w-6 text-primary-600"})})]})}),e.jsx(v,{hover:!0,className:"group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-secondary-600 mb-1",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-warning-600",children:c.filter(s=>s.status==="pending").length}),e.jsx("p",{className:"text-xs text-secondary-500 mt-1",children:"Awaiting approval"})]}),e.jsx("div",{className:"p-3 bg-warning-100 rounded-xl group-hover:bg-warning-200 transition-colors",children:e.jsx(E,{className:"h-6 w-6 text-warning-600"})})]})}),e.jsx(v,{hover:!0,className:"group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-secondary-600 mb-1",children:t?.role==="provider"?"Active Services":"Confirmed"}),e.jsx("p",{className:"text-3xl font-bold text-success-600",children:t?.role==="provider"?p.filter(s=>s.availability).length:c.filter(s=>s.status==="confirmed").length}),e.jsx("p",{className:"text-xs text-secondary-500 mt-1",children:t?.role==="provider"?"Available now":"Ready to go"})]}),e.jsx("div",{className:"p-3 bg-success-100 rounded-xl group-hover:bg-success-200 transition-colors",children:e.jsx(O,{className:"h-6 w-6 text-success-600"})})]})})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary-900",children:"Recent Reservations"}),e.jsxs("p",{className:"text-sm text-secondary-600 mt-1",children:[_.length," of ",c.length," reservations"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"h-4 w-4 text-secondary-400"}),e.jsxs("select",{value:d,onChange:s=>C(s.target.value),className:"text-sm border-secondary-300 rounded-lg px-3 py-1.5 focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),t?.role==="captain"&&e.jsx($,{onClick:()=>w(!0),icon:e.jsx(P,{className:"h-4 w-4"}),size:"sm",children:"New Reservation"})]})]}),e.jsx("div",{className:"space-y-4",children:_.length===0?e.jsx(Q,{icon:e.jsx(D,{className:"h-12 w-12"}),title:"No reservations found",description:t?.role==="captain"?"Get started by creating your first service reservation.":"No reservations found for the selected filter.",action:t?.role==="captain"?{label:"Create Reservation",onClick:()=>w(!0),icon:e.jsx(P,{className:"h-4 w-4"})}:void 0}):_.map(s=>e.jsx(v,{padding:"md",hover:!0,className:"group cursor-pointer",onClick:()=>m("reservations"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-3xl p-2 bg-secondary-100 rounded-lg group-hover:bg-secondary-200 transition-colors",children:q(s.services?.type||"tugboat")}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-base font-semibold text-secondary-900",children:s.ship_name}),s.ship_imo&&e.jsxs("span",{className:"text-xs text-secondary-500 font-mono bg-secondary-100 px-2 py-0.5 rounded",children:["IMO: ",s.ship_imo]})]}),e.jsxs("p",{className:"text-sm text-secondary-600 mb-2",children:[s.services?.name," • ",s.services?.ports?.name]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-secondary-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-3 w-3"}),U(new Date(s.requested_date),"MMM dd, yyyy")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"h-3 w-3"}),s.requested_time," (",s.duration_hours,"h)"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s.total_cost&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-semibold text-secondary-900",children:["$",s.total_cost]}),e.jsx("p",{className:"text-xs text-secondary-500",children:"Total cost"})]}),e.jsx(I,{variant:x(s.status),size:"md",children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})]})},s.id))})]}),b&&e.jsx(G,{onClose:()=>w(!1),onSuccess:()=>{a(),u("Reservation created successfully!")}})]})};export{K as default};
